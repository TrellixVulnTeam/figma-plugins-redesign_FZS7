"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.watch = void 0;
const common_1 = require("@create-figma-plugin/common");
const chokidar = require("chokidar");
const build_async_1 = require("./build-async");
const ignoreRegex = new RegExp([
    '(?:^|\\/)',
    '\\.',
    '[^.]+',
    '|(?:.scss.d.ts$)',
    `|${common_1.constants.build.directoryName}`,
    `|${common_1.constants.build.manifestFilePath}`,
    '|node_modules'
].join(''));
function watch() {
    const watcher = chokidar.watch('.', {
        ignored: function (path) {
            return ignoreRegex.test(path);
        }
    });
    async function onChangeAsync() {
        await build_async_1.buildAsync(true, false);
        common_1.log.info('Watching...');
    }
    watcher.on('ready', onChangeAsync);
    watcher.on('change', async function (file) {
        common_1.log.info(`Changed: ${file}`);
        await onChangeAsync();
    });
}
exports.watch = watch;
//# sourceMappingURL=watch.js.map