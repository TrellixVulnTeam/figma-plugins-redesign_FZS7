"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cloneFromTemplateAsync = void 0;
const degit_1 = require("degit");
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const gitHubRepositoryRegex = /[\w-]+\/[\w-]+/;
async function cloneFromTemplateAsync(pluginDirectoryPath, template) {
    const templateDirectory = path_1.resolve(__dirname, '..', 'plugin-templates', template);
    if ((await fs_extra_1.pathExists(templateDirectory)) === true) {
        await fs_extra_1.ensureDir(pluginDirectoryPath, 0o2775);
        await fs_extra_1.copy(templateDirectory, pluginDirectoryPath);
        const npmIgnoreFile = path_1.join(pluginDirectoryPath, '.npmignore');
        if ((await fs_extra_1.pathExists(npmIgnoreFile)) === true) {
            // When running via npm/npx, the .gitignore file is renamed to .npmignore,
            // so we need to rename it back
            const gitIgnoreFile = path_1.join(pluginDirectoryPath, '.gitignore');
            await fs_extra_1.move(npmIgnoreFile, gitIgnoreFile);
        }
        return;
    }
    if (gitHubRepositoryRegex.test(template) === false) {
        throw new Error('Invalid GitHub repository');
    }
    await degit_1.default(template, {}).clone(pluginDirectoryPath);
}
exports.cloneFromTemplateAsync = cloneFromTemplateAsync;
//# sourceMappingURL=clone-from-template-async.js.map